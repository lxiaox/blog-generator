---
title: 登录注册与Cookie
date: 2018-08-26 15:33:42
tags: （W）登录注册、cookie
---
## 注册与登录基本过程
登录与注册是我们日常浏览网页一个很普遍的行为，大部分网站都有用户登录机制。例如：当我们访问某一个网站时，如淘宝，不登录的时候也能看到淘宝的各种页面或者商品，但是收藏商品或将其添加至购物车时，就需要用户登录了，用户登录后就可以进行更多的操作。在用户眼中的登录注册就是用户名与密码输入正确，那么在程序中登录与注册过程中到底发生了什么？现在来总结一下：
#### 注册
首先，点击到注册页面，最简单的注册页面就是输入id（用户名或邮箱等）、输入密码、确认密码和注册按钮，通常前端程序员会在点击注册时进行一些验证，如邮箱用户名是否符合规范，两次密码是否匹配等，并作出一些修改提示，然后正确之后将这些信息发送给后端，这时后端程序员需要再进行验证，因为发送请求完全可以绕过页面的JS，比如使用curl发送请求，所以前端的验证是可有可无的，但后端的验证是必须的。当后端验证成功之后，就会将信息存入数据库。这时用户就可以进入登录页面进行验证。
#### 登录
登录页面与注册页面代码大同小异，当用户点击登录按钮时，浏览器就会将登录信息发送给服务器，也就是后端，后端服务器再将id与数据库中的数据进行比较，当找到匹配的id再进行密码验证，当这些都正确时，浏览器就会根据用户id获取到存储的用户信息，将相应信息填到页面中，然后将新的登录后的页面返回给客户端，也就是浏览器，展示出来。

## Cookie
上面说到了服务器对用户登录的处理，事实上，在登录成功之后服务器还会做一件事情，那就是向浏览器发送一段cookie 信息，并保存在浏览器的response Header中，并且下次用户使用同一个浏览器访问这个页面时，浏览器向服务器发送请求时也会带上这段cookie数据。那么，cookie 到底是什么呢？

Cookie 就是一个小型的文本文件，它存储了用户的身份信息。
#### cookie分类
cookie也是有时间限制的，一般默认20分钟左右，不同的浏览器不尽相同，当然也可以强制设置cookie的保存时间，没有设置期限的Cookie保存于浏览器**内存**，设置了过期时间就保存在**硬盘**中，所以按存储位置可分为**内存Cookie** 和 **硬盘Cookie**。内存cookie在浏览器关闭之后就会消失，硬盘cookie 则不会，除非用户手动删除，或到了过期时间，因此按保存时间又可以分为**非持久Cookie** 和 **持久Cookie**。

### 为什么需要cookie
+ cookie的第一个作用就是**记录历史**。因为HTTP的无状态性，服务器不知道用户上一次作了什么，比如用户浏览器几个页面，买了几件物品，结账的时候却不知道买的物品是什么，cookie就可以记录商品信息。大致过程是：当用户选购了一样东西，服务器向用户发送页面的同时还会发送cookie记录着商品信息，当用户浏览新的页面时，又向服务器发送cookie，这样服务器就知道了购物信息，当用户想再添加商品时，只需追加cookie信息，最后结账时，服务器只需读取发来的cookie信息。
+ cookie第二个作用就是**识别用户身份**。当用户登录页面时，服务器会给每个用户分配id，并向页面发送送包含id的cookie，不同的用户登录时会带着不同的cookie，这样服务器就可以区分不同的用户了。
+ cookie还有一个典型应用就是自动登录，当用户登录时选中自动登录，那么下一次登录时就不需要再次输入用户名密码，这是因为服务器在用户登录之后会向用户发送cookie，cookie包含了登录凭证(用户名密码的加密形式)。只要cookie没到过期时间，下次登录浏览器就会向服务器发送cookie，cookie相当于一张门票，让用户不需再次输入用户名密码而 自动登录。

### 设置cookie
服务器端通过下列代码可以设置cookie：
	
	setcookie($name, $value, $expire, $path, $domain, $secure)
	//eg：response.setHeader('Set-Cookie', `sign_in_email=${email}`) 
这里要注意 `$domain` 指定了域名，cookie是不能跨域访问的。

[更多设置cookie的语法](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie)

### cookie的缺陷
1. Cookie会被附加在每个HTTP请求中，所以无形中增加了流量。
2. 由于在HTTP请求中的Cookie是明文传递的，所以安全性成问题，除非用HTTPS。
3. Cookie的大小限制在4KB左右，对于复杂的存储需求来说是不够用的。
